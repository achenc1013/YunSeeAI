# 🧪 CMS识别功能测试指南

## 快速开始

### 1. 启动系统

```bash
npm start
```

### 2. 测试CMS识别

#### 测试用例1: 带端口号的IP地址

**输入：**
```
http://192.168.20.155:12345 这个网站用了啥CMS框架？
```

**预期结果：**
- ✅ 正确识别目标为 `http://192.168.20.155:12345`
- ✅ 显示"类型：cms"
- ✅ 实际请求使用12345端口（查看DEBUG输出）
- ✅ 返回CMS识别结果或"未识别到CMS"

**检查点：**
```
✓ 检测到扫描请求，正在执行扫描...
✓ 目标：http://192.168.20.155:12345
✓ 类型：cms

[DEBUG] Scanning target: http://192.168.20.155:12345
[DEBUG] Making request to: http://192.168.20.155:12345
```

---

#### 测试用例2: 域名CMS识别

**输入：**
```
请问 https://www.example.com 使用了什么CMS？
```

**预期结果：**
- ✅ 识别CMS类型
- ✅ 显示置信度
- ✅ 显示相关技术栈

---

#### 测试用例3: 带路径的URL

**输入：**
```
http://192.168.1.100:8080/admin/ 用了什么CMS框架？
```

**预期结果：**
- ✅ 完整保留URL: `http://192.168.1.100:8080/admin/`
- ✅ 正确扫描该路径

---

### 3. 查看调试信息

在终端中查看stderr输出，确认：

```
[DEBUG] Scanning target: http://192.168.20.155:12345
[DEBUG] Making request to: http://192.168.20.155:12345
[DEBUG] Making request to: http://192.168.20.155:12345/wp-admin/
[DEBUG] Making request to: http://192.168.20.155:12345/wp-content/
...
```

**验证点：**
- 所有请求都使用了正确的端口号（12345）
- 不应该出现默认的80或443端口

---

## 🔍 DEBUG模式

### 启用详细日志

修改 `scanner/fingerprint.py` 中的超时时间以便调试：

```python
def __init__(self, target: str, timeout: int = 30):  # 增加超时时间
```

### 监控HTTP请求

使用以下命令查看实际的HTTP流量：

```bash
# Windows (PowerShell)
netstat -ano | findstr "12345"

# 查看Python进程的连接
netstat -ano | findstr "python"
```

---

## ✅ 验证清单

### URL识别测试

- [ ] `http://192.168.1.1` → 识别为 `http://192.168.1.1`
- [ ] `http://192.168.1.1:8080` → 识别为 `http://192.168.1.1:8080`
- [ ] `http://192.168.1.1:8080/` → 识别为 `http://192.168.1.1:8080/`
- [ ] `http://192.168.1.1:8080/path` → 识别为 `http://192.168.1.1:8080/path`
- [ ] `192.168.1.1:8080` → 识别为 `192.168.1.1:8080`（会被加上https://）

### CMS识别测试

- [ ] WordPress网站 → 正确识别
- [ ] Joomla网站 → 正确识别
- [ ] Drupal网站 → 正确识别
- [ ] Discuz论坛 → 正确识别
- [ ] DedeCMS网站 → 正确识别
- [ ] 自定义网站 → 提示"未识别到CMS"

### 端口测试

- [ ] 80端口（HTTP默认） → 正常工作
- [ ] 443端口（HTTPS默认） → 正常工作
- [ ] 8080端口（常用代理） → 正确使用8080
- [ ] 12345端口（自定义） → 正确使用12345
- [ ] 3000端口（开发环境） → 正确使用3000

---

## 🐛 常见问题排查

### 问题1: 显示扫描了指定端口，但实际使用默认端口

**诊断步骤：**
1. 查看DEBUG输出
```
[DEBUG] Scanning target: http://192.168.20.155:12345
```

2. 检查是否有端口号

3. 使用网络监控工具验证

**可能原因：**
- URL正则表达式未正确匹配
- Python端URL处理有误
- 网络代理修改了请求

**解决方案：**
- 检查正则表达式匹配结果
- 查看Python的调试输出
- 确认`_normalize_url`函数正确

---

### 问题2: 无法识别到CMS

**诊断步骤：**
1. 检查网络连接
```bash
curl http://192.168.20.155:12345
```

2. 查看HTTP响应
```bash
curl -I http://192.168.20.155:12345
```

3. 检查DEBUG输出中的错误信息

**可能原因：**
- 目标端口未开放
- 防火墙阻止连接
- 目标网站无响应
- CMS不在指纹库中

---

### 问题3: 连接超时

**解决方案：**
1. 增加超时时间
```python
scanner = FingerprintScanner(target, timeout=30)
```

2. 检查网络连接
```bash
ping 192.168.20.155
telnet 192.168.20.155 12345
```

3. 确认防火墙设置

---

## 📊 性能测试

### 单个目标扫描时间

| 场景 | 预期时间 | 说明 |
|------|---------|------|
| 标准CMS（WordPress） | 2-5秒 | 快速识别 |
| 需要路径探测 | 5-10秒 | 多次HTTP请求 |
| 无CMS | 3-8秒 | 完整指纹扫描 |
| 连接失败 | <10秒 | 超时限制 |

### 并发扫描

```javascript
// 测试多个目标
const targets = [
    'http://example1.com',
    'http://192.168.1.1:8080',
    'http://example2.com:3000'
];

// 建议：顺序扫描，避免资源占用
for (const target of targets) {
    await scanCMS(target);
}
```

---

## 🎯 下一步

测试通过后，可以：
1. 将CMS识别集成到漏洞扫描流程
2. 自动关联CMS版本与CVE数据库
3. 生成安全评估报告

---

**测试完成后，请记录：**
- ✅ 哪些功能正常工作
- ❌ 哪些功能存在问题
- 💡 改进建议

Happy Testing! 🚀

