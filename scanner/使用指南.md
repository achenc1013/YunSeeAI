# YunSeeAI 资产收集模块 - 快速使用指南

## 📋 功能介绍

这是YunSeeAI项目的资产收集模块，可以让AI听懂人话并执行安全扫描任务。

**支持的功能：**
- 🔍 端口扫描 - 发现开放端口和服务
- 🌐 指纹识别 - 识别网站使用的框架和技术
- 🤖 自然语言 - AI理解"人话"并自动调用工具

## 🚀 快速开始

### 1. 环境要求

- Python 3.13+ 
- Node.js 14+
- PowerShell (你已经在使用)

### 2. 测试安装

```powershell
# 测试Python是否可用
python --version

# 测试端口扫描工具
python scanner/port_scanner.py example.com

# 测试指纹识别工具
python scanner/fingerprint.py https://example.com

# 运行完整测试套件
node scanner/test-scanner.js
```

## 💬 自然语言使用示例

AI可以理解这些类似的话：

### 询问端口

```javascript
"我想知道 https://example.com 这个网站开放了哪些端口"
"example.com 有哪些端口是开放的？"
"扫描一下 192.168.1.1 的端口"
"检查 github.com 的服务"
```

### 询问框架

```javascript
"我想知道 https://example.com 这个网站用的什么框架"
"example.com 用的是什么技术栈？"
"https://github.com 是用什么搭建的？"
"检测 baidu.com 使用的CMS"
```

### 完整扫描

```javascript
"扫描 https://example.com"
"全面检查 example.com"
"帮我分析一下 google.com"
```

## 📝 代码集成示例

### 方式1: 简单集成（推荐）

```javascript
import { processQuery } from './scanner/ai-integration.js';

// 用户输入
const userInput = "我想知道 https://example.com 用的什么框架";

// AI处理并执行扫描
const result = await processQuery(userInput);

if (result.success) {
  console.log(result.ai_response);  // AI生成的自然语言回复
  console.log(result.raw_results);   // 原始扫描数据
}
```

### 方式2: 直接调用工具

```javascript
import { scanPorts, scanFingerprint, scanFull } from './scanner/scanner-client.js';

// 端口扫描
const ports = await scanPorts('example.com', 'common', 5);
console.log(ports);

// 指纹识别
const fingerprint = await scanFingerprint('https://example.com', 10);
console.log(fingerprint);

// 完整扫描
const full = await scanFull('example.com');
console.log(full);
```

### 方式3: 与你的AI模型集成

```javascript
import { getToolDefinitions, executeTool } from './scanner/tools-registry.js';
import { SCANNER_SYSTEM_PROMPT } from './scanner/ai-integration.js';

// 1. 获取工具定义，传给你的AI模型
const tools = getToolDefinitions();

// 2. 使用系统提示词
const systemPrompt = SCANNER_SYSTEM_PROMPT;

// 3. 当AI决定调用工具时
const toolName = 'scan_fingerprint';  // AI选择的工具
const args = { target: 'https://example.com' };  // AI提供的参数

const result = await executeTool(toolName, args);
console.log(result);
```

## 🛠️ 可用工具

### 1. scan_ports - 端口扫描

扫描目标的开放端口和服务。

```javascript
await executeTool('scan_ports', {
  target: 'example.com',        // 目标网址/IP
  ports: 'common',               // 'common' | 'all' | '80,443,8080'
  timeout: 5                     // 超时时间(秒)
});
```

### 2. scan_fingerprint - 指纹识别

识别网站使用的框架、CMS和技术。

```javascript
await executeTool('scan_fingerprint', {
  target: 'https://example.com', // 目标网址
  timeout: 10                     // 超时时间(秒)
});
```

### 3. scan_full - 完整扫描

同时执行端口扫描和指纹识别。

```javascript
await executeTool('scan_full', {
  target: 'example.com',
  ports: 'common',
  timeout: 10
});
```

## 📊 返回数据格式

### 端口扫描结果

```json
{
  "success": true,
  "target": "example.com",
  "target_ip": "93.184.216.34",
  "open_ports": [
    {
      "port": 80,
      "service": "HTTP",
      "state": "open"
    },
    {
      "port": 443,
      "service": "HTTPS",
      "state": "open"
    }
  ],
  "total_scanned": 20,
  "total_open": 2
}
```

### 指纹识别结果

```json
{
  "success": true,
  "target": "https://example.com",
  "technologies": [
    {
      "name": "Nginx",
      "confidence": "high",
      "type": "Web Server"
    },
    {
      "name": "WordPress",
      "confidence": "medium",
      "type": "CMS"
    }
  ],
  "server_info": {
    "server": "nginx/1.18.0"
  },
  "total_detected": 2
}
```

## 🔧 在你的CLI中集成

```javascript
// 你的 CLI 主文件
import readline from 'readline';
import { processQuery } from './scanner/ai-integration.js';

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('YunSeeAI 智能安全助手');
console.log('输入你的问题...\n');

function prompt() {
  rl.question('你: ', async (input) => {
    if (input === 'exit') {
      console.log('再见！');
      rl.close();
      return;
    }
    
    // 检查是否是扫描请求
    const scanKeywords = ['扫描', '端口', '框架', '网站', '技术'];
    const isScan = scanKeywords.some(kw => input.includes(kw));
    
    if (isScan) {
      console.log('AI: 正在扫描...\n');
      
      const result = await processQuery(input);
      
      if (result.success) {
        console.log('AI:', result.ai_response);
      } else {
        console.log('AI: 扫描出错:', result.error);
      }
    } else {
      // 其他问题交给你的主AI模型处理
      console.log('AI: [你的AI模型回复]');
    }
    
    console.log('\n');
    prompt();
  });
}

prompt();
```

## ⚠️ 注意事项

1. **权限问题**: 某些端口扫描需要管理员权限
   ```powershell
   # 以管理员身份运行PowerShell
   ```

2. **扫描目标**: 只扫描你有权限扫描的目标
   - ✅ 扫描自己的服务器
   - ✅ 扫描授权的测试目标（如 scanme.nmap.org）
   - ❌ 未经授权扫描他人服务器（可能违法）

3. **超时设置**: 网络慢时增加超时时间
   ```javascript
   await scanPorts('example.com', 'common', 10);  // 10秒超时
   ```

4. **Python路径**: 如果提示找不到Python
   ```javascript
   // 修改 scanner-client.js 中的Python命令
   const pythonProcess = spawn('python3', [scriptPath, ...args]);
   ```

## 📚 更多文档

- `README.md` - 完整英文文档
- `INTEGRATION_GUIDE.md` - 详细集成指南
- `example-usage.js` - 使用示例代码

## 🧪 测试

运行测试确保一切正常：

```powershell
# 运行完整测试套件
node scanner/test-scanner.js

# 运行示例
node scanner/example-usage.js
```

## ❓ 常见问题

### Q: Python找不到？
**A**: 确保Python在PATH中，或修改 `scanner-client.js` 使用完整路径

### Q: 扫描超时？
**A**: 增加timeout参数：`await scanPorts(target, 'common', 10)`

### Q: 需要管理员权限？
**A**: 以管理员身份运行PowerShell

### Q: 如何添加更多指纹规则？
**A**: 编辑 `fingerprint.py` 中的 `FINGERPRINTS` 字典

## 🎯 快速测试命令

```powershell
# 测试1: 端口扫描
python scanner/port_scanner.py example.com

# 测试2: 指纹识别
python scanner/fingerprint.py https://example.com

# 测试3: 完整扫描
python scanner/scanner_main.py example.com --scan-type full

# 测试4: Node.js集成
node -e "import('./scanner/scanner-client.js').then(m => m.scanPorts('example.com').then(console.log))"

# 测试5: 自然语言处理
node -e "import('./scanner/ai-integration.js').then(m => m.processQuery('What ports are open on example.com?').then(r => console.log(r.ai_response)))"
```

## ✨ 功能特点

- ✅ 纯英文代码，兼容性强
- ✅ 使用Python标准库，无需额外依赖
- ✅ 多线程扫描，速度快
- ✅ 自然语言理解
- ✅ 完整的错误处理
- ✅ 详细的扫描结果
- ✅ 支持函数调用（Function Calling）
- ✅ 兼容各种AI模型

## 📞 技术支持

如遇问题：
1. 查看 `README.md` 的故障排除部分
2. 运行 `node scanner/test-scanner.js` 诊断
3. 检查Python版本：`python --version`

---

**YunSeeAI 资产收集模块** - 让AI听懂人话去扫描 🛡️

